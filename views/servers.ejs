<%- include('layout', { body: `
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-white">
      ${activeCategory ? activeCategory.name + ' MCP Servers' : search ? 'Search Results' : 'Browse MCP Servers'}
    </h1>
    <p class="text-gray-400 text-sm mt-1">${total.toLocaleString()} servers found</p>
  </div>

  <!-- Filters -->
  <form action="/servers" method="GET" class="mb-8 flex flex-col sm:flex-row gap-3">
    <input
      type="text"
      name="search"
      value="${search}"
      placeholder="Search servers..."
      class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-brand-500"
    >
    <select name="sort" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-brand-500">
      <option value="quality" ${sort === 'quality' ? 'selected' : ''}>Quality Score</option>
      <option value="stars" ${sort === 'stars' ? 'selected' : ''}>Stars</option>
      <option value="downloads" ${sort === 'downloads' ? 'selected' : ''}>Downloads</option>
      <option value="recent" ${sort === 'recent' ? 'selected' : ''}>Recently Updated</option>
      <option value="name" ${sort === 'name' ? 'selected' : ''}>Name</option>
    </select>
    <select name="category" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-brand-500">
      <option value="">All Categories</option>` +
      categories.map(c => `<option value="${c.slug}" ${activeCategory && activeCategory.slug === c.slug ? 'selected' : ''}>${c.name}</option>`).join('') + `
    </select>
    <button type="submit" class="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2 rounded-lg text-sm font-medium transition-colors">
      Filter
    </button>
  </form>

  <!-- Server Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">` +
    servers.map(server => `
    <a href="/servers/${server.slug}" class="block bg-gray-900 border border-gray-800 rounded-xl p-5 hover:border-brand-500/50 hover:bg-gray-900/80 transition-all group">
      <div class="flex items-start justify-between gap-3 mb-3">
        <h3 class="font-semibold text-white group-hover:text-brand-400 transition-colors truncate text-sm">${server.name}</h3>
        ${server.qualityScore ? `<span class="shrink-0 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${server.qualityScore >= 70 ? 'bg-green-900/50 text-green-400' : server.qualityScore >= 40 ? 'bg-yellow-900/50 text-yellow-400' : 'bg-gray-800 text-gray-400'}">${server.qualityScore}</span>` : ''}
      </div>
      <p class="text-gray-400 text-xs line-clamp-2 mb-3 min-h-[2rem]">${server.description || 'No description available'}</p>
      <div class="flex items-center gap-3 text-xs text-gray-500">
        ${server.stars ? `<span>${server.stars.toLocaleString()} &#9733;</span>` : ''}
        ${server.weeklyDownloads ? `<span>${server.weeklyDownloads.toLocaleString()}/wk</span>` : ''}
        ${server.category ? `<span class="text-brand-400/70">${server.category.name}</span>` : ''}
      </div>
    </a>`).join('') + `
  </div>

  <!-- Pagination -->
  ${totalPages > 1 ? `
  <div class="mt-8 flex items-center justify-center gap-2">
    ${page > 1 ? `<a href="/servers?search=${encodeURIComponent(search)}&sort=${sort}${activeCategory ? '&category=' + activeCategory.slug : ''}&page=${page - 1}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-300 hover:bg-gray-700 transition-colors">&larr; Prev</a>` : ''}
    <span class="px-3 py-2 text-sm text-gray-400">Page ${page} of ${totalPages}</span>
    ${page < totalPages ? `<a href="/servers?search=${encodeURIComponent(search)}&sort=${sort}${activeCategory ? '&category=' + activeCategory.slug : ''}&page=${page + 1}" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-300 hover:bg-gray-700 transition-colors">Next &rarr;</a>` : ''}
  </div>` : ''}
</div>
` }) %>
